<extend name="public:template" />

<block name="main">

<link rel="stylesheet" type="text/css" href="__CSS__/show_photo.css">


<div class="show_photo_container">
	<a href="#"><i class="fa fa-3x fa-chevron-left"></i></a>
		<img id="photo" src="__PH__/{$username}/{$photo.filename}" >
	<a href="#"><i class="fa fa-3x fa-chevron-right"></i></a>
	<div class="btn-group-vertical" id="show_photo_control_panel">
		
	    <button id="comment" type="button" class="btn btn-default btn-lg"><a href="#edit-comment">评论</a> </button>
	    <button type="button" class="btn btn-default btn-lg"><a href="__APP__/Api/del_pic?id={$photo.id}">删除</a></button>
	    <button type="button" class="btn btn-default btn-lg"><a href="__PH__/{$username}/{$photo.filename}" download="photo">下载</a></button>
	    <button id="embellish" type="button" class="btn btn-default btn-lg">美化</button>
	    
	    <if condition="$sid eq 0 ">
	    <button type="button" class="btn btn-default btn-lg"><a href="__APP__/Api/set_share?id={$photo.id}">分享</a></button>
		<else />
		<button type="button" class="btn btn-default btn-lg"><a href="__APP__/Index/share/id/{$sid}">前往</a></button>
		<button type="button" class="btn btn-default btn-lg"><a href="__APP__/Api/set_noshare?id={$photo.id}">取消分享</a></button>
		</if>
	    <!-- {$sid} -->
	    
	    
	</div>
</div>

<div id="comment-container" class="show_photo_comment"></div>

<div id="edit-comment">
	<textarea id="comment-text" style="width: 100%;height: 100px;border-radius: 4px" placeholder="我有话说..."></textarea>
	<input type="button" class="btn btn-default" name="" id="submite-comment" value="发表" />
</div>

<div class="embellish" hidden>
    <form class="form-inline embellish-input" role="form">
		<div class="form-group">
			<label class="sr-only" for="name">参数1</label>
		    <input type="text" class="form-control" id="name1" placeholder="参数1">
		</div>
		<div class="form-group">
			<label class="sr-only" for="name">参数2</label>
		    <input type="text" class="form-control" id="name2" placeholder="参数2">
		</div>
		<div class="form-group">
			<label class="sr-only" for="name">参数2</label>
		    <input type="text" class="form-control" id="name3" placeholder="参数2">
		</div>
		<input type="button" name="" class="btn btn-default" value="预览" />
		<div class="embellish-img-container">
			<img id="embellish-img" src="__PH__/{$username}/{$photo.filename}">
		</div>
		<button  class="btn btn-default">下载</button>
	</form>

    <div class="gray-canvas"> 
        <i class="fa fa-fw fa-close gray-canvas-close"></i>
    </div>
    <!-- 灰色悬浮层 -->
</div>

<script type="text/javascript">
	var pid = {$photo.id};
	var user = "{$username}";
	$.get('__APP__/Api/getComment/',{"pid":pid },function(res){
		for (var i = 0; i <res.length; i++) {
			var name = res[i].guestname;
			var text = res[i].content;
			var time = res[i].addtime;
			$('#comment-container').append('<div class="panel panel-default"> <div class="panel-heading"> <h3 class="panel-title"> '+name+' </h3> </div> <div class="panel-body">'+text+'</div> </div>')
		}
	})
	$('#submite-comment').click(function(){
		var text = $('#comment-text').val();
		
		
		$.get('__APP__/Api/setComment',{"pid":pid,"name":user,"content":text},function(res){
			console.log(res);
			location.reload()
		})

		// photoid' => $arr['pid'],{$photo.id}
		// 			'guestname' => $arr['name'],
		// 			'addtime'  => date('Y-m-d H:i:s'),
		// 			'content' => $arr['content'],
	})

	$('#embellish').click(function(){
		$(".embellish").css({"display":"block"});
		$('#wrapper').css({'overflow': 'hidden'});
	})

	$('.gray-canvas-close').click(function(){
		$(".embellish").css({"display":"none"});
		$('#wrapper').css({'overflow': 'auto'});
    })

    $.get("__APP__/Api/setNoticeread",{sid:"{$sid}"});

</script>



</block>


